[{"question":"What is the average order total for customers in each state who have placed at least 5 orders?","query":"SELECT c.state, AVG(order_total) AS avg_order_total\nFROM (\n  SELECT c.customer_id, c.state, SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) AS order_total\n  FROM customers c\n  JOIN orders o ON c.customer_id = o.customer_id\n  JOIN order_items oi ON o.order_id = oi.order_id\n  GROUP BY c.customer_id, c.state\n  HAVING COUNT(o.order_id) >= 5\n) c\nGROUP BY c.state;","db_id":"sales_example","creator":"Claude"},{"question":"Find the top 5 products by total revenue for each category, considering only orders placed by customers aged 25 to 35.","query":"SELECT p.category, p.name, SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) AS total_revenue\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nJOIN customers c ON o.customer_id = c.customer_id\nJOIN demographics d ON c.customer_id = d.customer_id\nWHERE d.age BETWEEN 25 AND 35\nGROUP BY p.category, p.name\nHAVING SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) > 0\nORDER BY p.category, total_revenue DESC\nLIMIT 5;","db_id":"sales_example","creator":"Claude"},{"question":"What is the average income of customers who have purchased products from suppliers located in California?","query":"SELECT AVG(d.income) AS avg_income\nFROM demographics d\nJOIN customers c ON d.customer_id = c.customer_id\nJOIN orders o ON c.customer_id = o.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nJOIN products p ON oi.product_id = p.product_id\nJOIN suppliers s ON p.supplier_id = s.supplier_id\nWHERE s.state = 'CA';","db_id":"sales_example","creator":"Claude"},{"question":"Find the most popular product category for each occupation, based on the total quantity of products ordered.","query":"SELECT d.occupation, p.category, SUM(oi.quantity) AS total_quantity\nFROM demographics d\nJOIN customers c ON d.customer_id = c.customer_id\nJOIN orders o ON c.customer_id = o.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nJOIN products p ON oi.product_id = p.product_id\nGROUP BY d.occupation, p.category\nHAVING SUM(oi.quantity) = (\n  SELECT MAX(quantity_sum)\n  FROM (\n    SELECT SUM(oi2.quantity) AS quantity_sum\n    FROM demographics d2\n    JOIN customers c2 ON d2.customer_id = c2.customer_id\n    JOIN orders o2 ON c2.customer_id = o2.customer_id\n    JOIN order_items oi2 ON o2.order_id = oi2.order_id\n    JOIN products p2 ON oi2.product_id = p2.product_id\n    WHERE d2.occupation = d.occupation\n    GROUP BY p2.category\n  ) t\n);","db_id":"sales_example","creator":"Claude"},{"question":"What is the total revenue generated by customers in each zip code, considering only orders placed in the past 12 months?","query":"SELECT c.zip_code, SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) AS total_revenue\nFROM customers c\nJOIN orders o ON c.customer_id = o.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nWHERE o.order_date >= DATE(date('now'), '-12 months')\nGROUP BY c.zip_code;","db_id":"sales_example","creator":"Claude"},{"question":"Find the top 3 suppliers by total order value for each product category.","query":"SELECT p.category, s.name AS supplier_name, SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) AS total_order_value\nFROM suppliers s\nJOIN products p ON s.supplier_id = p.supplier_id\nJOIN order_items oi ON p.product_id = oi.product_id\nGROUP BY p.category, s.name\nHAVING SUM(oi.quantity * oi.unit_price - oi.discount + oi.adjustment) > 0\nORDER BY p.category, total_order_value DESC\nLIMIT 3;","db_id":"sales_example","creator":"Claude"},{"question":"What is the average order total for customers with different marital statuses and education levels?","query":"SELECT d.marital_status, d.education, AVG(order_total) AS avg_order_total\nFROM (\n  SELECT d.customer_id, d.marital_status, d.education, SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) AS order_total\n  FROM demographics d\n  JOIN customers c ON d.customer_id = c.customer_id\n  JOIN orders o ON c.customer_id = o.customer_id\n  JOIN order_items oi ON o.order_id = oi.order_id\n  GROUP BY d.customer_id, d.marital_status, d.education\n) d\nGROUP BY d.marital_status, d.education;","db_id":"sales_example","creator":"Claude"},{"question":"Find the most profitable product for each supplier, considering the total profit (revenue - cost) generated by each product.","query":"WITH subtable AS\n(SELECT p2.supplier_id, p2.product_id, SUM(oi2.quantity * ((oi2.unit_price - oi2.discount + oi2.adjustment) - p2.price)) AS profit_sum\n  FROM products p2\n  JOIN order_items oi2 ON p2.product_id = oi2.product_id\n  GROUP BY p2.supplier_id, p2.product_id \n),\nsubtable2 AS \n(SELECT tbl.supplier_id, MAX(profit_sum) AS max_profit_sum\nFROM subtable AS tbl\nGROUP BY tbl.supplier_id\n)\nSELECT s.name AS supplier_name, p.name AS product_name\nFROM suppliers s\nJOIN products p ON s.supplier_id = p.supplier_id\nJOIN subtable tbl ON s.supplier_id = tbl.supplier_id\nAND p.product_id = tbl.product_id\nJOIN subtable2 tbl2 ON s.supplier_id = tbl.supplier_id\nWHERE tbl.profit_sum = tbl2.max_profit_sum;","db_id":"sales_example","creator":"Claude"},{"question":"What is the average household size of customers who have purchased products in the \"Electronics\" category?","query":"SELECT AVG(d.household_size) AS avg_household_size\nFROM demographics d\nJOIN customers c ON d.customer_id = c.customer_id\nJOIN orders o ON c.customer_id = o.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nJOIN products p ON oi.product_id = p.product_id\nWHERE p.category = 'Electronics';","db_id":"sales_example","creator":"Claude"},{"question":"Find the top 5 cities by total revenue for each state, considering only orders placed by customers with an income greater than the average income.","query":"SELECT c.state, c.city, SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) AS total_revenue\nFROM customers c\nJOIN demographics d ON c.customer_id = d.customer_id\nJOIN orders o ON c.customer_id = o.customer_id\nJOIN order_items oi ON o.order_id = oi.order_id\nWHERE d.income > (\n  SELECT AVG(income)\n  FROM demographics\n)\nGROUP BY c.state, c.city\nHAVING SUM(oi.quantity * (oi.unit_price - oi.discount + oi.adjustment)) > 0\nORDER BY c.state, total_revenue DESC\nLIMIT 5;","db_id":"sales_example","creator":"Claude"},{"question":"Who are the customers with the most orders in each city?","query":"WITH OrderCount AS (\n  SELECT \n    c.customer_id, \n    c.city,\n    COUNT(o.order_id) AS num_orders\n  FROM orders o\n  JOIN customers c ON o.customer_id = c.customer_id\n  GROUP BY c.customer_id, c.city\n)\nSELECT \n  city,\n  customer_id,\n  num_orders\nFROM (\n  SELECT \n    city,\n    customer_id,\n    num_orders,\n    RANK() OVER (PARTITION BY city ORDER BY num_orders DESC) AS rank\n  FROM OrderCount\n) RankedOrders\nWHERE rank = 1;","db_id":"sales_example","creator":"OpenAI"},{"question":"What are the most popular products in each state based on quantity sold?","query":"WITH ProductSales AS (\n  SELECT \n    c.state,\n    oi.product_id,\n    SUM(oi.quantity) AS total_quantity\n  FROM customers c\n  JOIN orders o ON c.customer_id = o.customer_id\n  JOIN order_items oi ON o.order_id = oi.order_id\n  GROUP BY c.state, oi.product_id\n)\nSELECT \n  state, \n  product_id,\n  total_quantity\nFROM (\n  SELECT \n    state,\n    product_id,\n    total_quantity,\n    RANK() OVER (PARTITION BY state ORDER BY total_quantity DESC) AS rank\n  FROM ProductSales\n) RankedProducts\nWHERE rank = 1;","db_id":"sales_example","creator":"OpenAI"},{"question":"What is the monthly revenue growth for each product category?","query":"WITH monthly_revenue AS (\n  SELECT\n    p.category,\n    strftime('%Y-%m', o.order_date) AS month,\n    SUM(oi.quantity * oi.unit_price - oi.discount + oi.adjustment) AS revenue\n  FROM products p\n  JOIN order_items oi ON p.product_id = oi.product_id\n  JOIN orders o ON oi.order_id = o.order_id\n  GROUP BY p.category, month\n),\nprevious_month_revenue AS (\n  SELECT\n    category,\n    month,\n    revenue,\n    LAG(revenue) OVER (PARTITION BY category ORDER BY month) AS prev_month_revenue\n  FROM monthly_revenue\n)\nSELECT\n  category,\n  month,\n  revenue,\n  CASE\n    WHEN prev_month_revenue IS NULL THEN NULL\n    ELSE (revenue - prev_month_revenue) \/ prev_month_revenue\n  END AS revenue_growth\nFROM previous_month_revenue\nORDER BY category, month;","db_id":"sales_example","creator":"OpenAI"},{"question":"Which state has the highest number of repeat customers?","query":"WITH CustomerOrders AS (\n  SELECT \n    c.customer_id, \n    c.state,\n    COUNT(DISTINCT o.order_id) AS order_count\n  FROM orders o\n  JOIN customers c ON o.customer_id = c.customer_id\n  GROUP BY c.customer_id, c.state\n)\nSELECT \n  state,\n  COUNT(customer_id) AS repeat_customers\nFROM CustomerOrders\nWHERE order_count > 1\nGROUP BY state\nORDER BY repeat_customers DESC;","db_id":"sales_example","creator":"OpenAI"},{"question":"What job orders the most Office Furniture?","query":"WITH office_furniture AS (\n  SELECT\n    p.product_id,\n    p.name\n  FROM products AS p\n  WHERE p.category = 'Office Furniture'\n  GROUP BY\n    p.product_id,\n    p.name\n)\nSELECT\n  *\nFROM office_furniture AS m\nJOIN order_items AS oi\n  ON m.product_id = oi.product_id\nJOIN orders AS o\n  ON oi.order_id = o.order_id\nJOIN demographics AS d\n  ON o.customer_id = d.customer_id\nGROUP BY\n  d.occupation\nORDER BY\n  SUM(oi.quantity) DESC\nLIMIT 1;","db_id":"sales_example","creator":"Laurel"},{"question":"What customers buy the most from suppliers who made more than 7k dollars of sales on Electronics items in 2023?","query":"WITH supplier_sales AS (\n  SELECT\n    s.name AS supplier_name,\n    SUM(oi.quantity * oi.unit_price) AS total_sales_amount\n  FROM orders AS o\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  JOIN products AS p\n    ON oi.product_id = p.product_id\n  JOIN suppliers AS s\n    ON p.supplier_id = s.supplier_id\n  WHERE\n    p.category = 'Electronics' AND STRFTIME('%Y', o.order_date) = '2023'\n  GROUP BY\n    s.name\n)\nSELECT\n  c.customer_id,\n  c.name AS customer_name,\n  SUM(oi.quantity * oi.unit_price) AS total_amount_spent\nFROM orders AS o\nJOIN order_items AS oi\n  ON o.order_id = oi.order_id\nJOIN products AS p\n  ON oi.product_id = p.product_id\nJOIN customers AS c\n  ON o.customer_id = c.customer_id\nJOIN supplier_sales AS ss\n  ON p.supplier_id = (\n    SELECT\n      supplier_id\n    FROM suppliers\n    WHERE\n      name = ss.supplier_name\n  )\nWHERE\n  ss.total_sales_amount > 7000\nGROUP BY\n  c.customer_id,\n  c.name\nORDER BY\n  total_amount_spent DESC;","db_id":"sales_example","creator":"Laurel"}]